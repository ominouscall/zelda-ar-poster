<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Twilight Memory</title>

<style>
    /* Fontes do projeto */
    @font-face {
        font-family: "WiiRegular";
        src: url("TPHylian-WiiRegular.otf");
    }
    @font-face {
        font-family: "GCNBold";
        src: url("TPHylian-GCNBold.otf");
    }

    /* Corpo da página */
    body {
        margin: 0;
        overflow: hidden;
        background: black;
        font-family: "WiiRegular", serif;
    }

    /* Vídeo principal de fundo */
    #bgVideo {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: 1;
        transition: filter 1s ease, opacity 1s ease;
        opacity: 1;
    }

    /* Filtros por horário do dia */
    .morningFilter {
        filter: brightness(1.15) saturate(1.1) sepia(0.08) hue-rotate(-5deg) contrast(1.03);
    }
    .afternoonFilter {
        filter: brightness(1.05) saturate(1.15) hue-rotate(8deg) contrast(1.05) saturate(1.08);
    }
    .nightFilter {
        filter: brightness(0.65) saturate(0.85) hue-rotate(-25deg) contrast(0.92) brightness(0.85);
    }

    /* Vídeo do easter egg de 10 cliques */
    #secretVideo {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: fill;
        z-index: 9999;
        display: none;
        background: black;
    }

    /* Tela inicial com botão Start */
    #overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        z-index: 2;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        backdrop-filter: blur(2px);
    }

    /* Frase aleatória */
    #quote {
        font-family: "WiiRegular";
        color: #e8d8a8;
        font-size: 1.3rem;
        max-width: 90vw;
        text-align: center;
        margin-bottom: 40px;
        text-shadow: 2px 2px 4px black;
    }

    /* Botão Press Start */
    #startButton {
        font-family: "GCNBold";
        font-size: 2rem;
        color: #e8d8a8;
        border: 2px solid #e8d8a8;
        padding: 12px 28px;
        border-radius: 4px;
        cursor: pointer;
        background: rgba(0,0,0,0.6);
        text-shadow: 2px 2px 4px black;
        transition: 0.25s;
    }

    #startButton:hover {
        background: rgba(255,255,255,0.1);
        transform: scale(1.05);
    }

    /* Fade usado em transições */
    #fadeLayer {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: black;
        z-index: 8;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1s ease;
    }

    /* Hitbox do easter egg secreto (10 cliques) */
    #linkHitbox {
        position: fixed;
        width: 10vw;
        height: 10vw;
        max-width: 150px;
        max-height: 150px;
        left: 18vw;
        top: 40vh;
        z-index: 5;
        background: rgba(255, 0, 0, 0);
    }

    /* Área dos botões da Ocarina */
    .ocarina-container {
        position: fixed;
        right: 20px;
        bottom: 20px;
        display: flex;
        gap: 12px;
        z-index: 10;
        opacity: 0;
        transition: opacity 1.4s ease;
        align-items: flex-end;
    }

    /* Botões individuais da Ocarina */
    .ocarina-btn {
        width: 65px;
        height: 65px;
        cursor: pointer;
        transition: transform 0.12s ease;
        -webkit-tap-highlight-color: transparent !important;
        outline: none !important;
        user-select: none;
        opacity: 0.82;
    }

    /* Feedback imediato ao toque */
    .ocarina-btn:active {
        transform: scale(0.86);
    }

    /* Botão UP levemente mais alto (formato triangular) */
    #btnUp {
        transform: translateY(-22px);
    }
</style>
</head>

<body>

<!-- Vídeo de fundo principal -->
<video id="bgVideo" src="video-vertical.mp4" autoplay loop muted playsinline></video>

<!-- Vídeo do easter egg de 10 cliques -->
<video id="secretVideo" src="easter-eggs/creepy-link-scene.mp4" playsinline></video>

<!-- Música de fundo -->
<audio id="bgMusic"></audio>

<!-- Som do Press Start -->
<audio id="pressSound" src="press-start.mp3"></audio>

<!-- Botões da Ocarina (aparecem apenas quando elegível) -->
<div id="ocarina" class="ocarina-container" style="display:none;">
    <img id="btnLeft"  class="ocarina-btn" src="ocarina/left-ar-oc.png">
    <img id="btnUp"    class="ocarina-btn" src="ocarina/up-ar-oc.png">
    <img id="btnRight" class="ocarina-btn" src="ocarina/right-ar-oc.png">
</div>

<!-- Tela inicial -->
<div id="overlay">
    <div id="quote"></div>
    <div id="startButton">PRESS START</div>
</div>

<!-- Layer de fade -->
<div id="fadeLayer"></div>

<!-- Hitbox para easter egg de 10 cliques -->
<div id="linkHitbox"></div>

<script>
/* Frases aleatórias */
const quotes = [
"“A sword wields no strength unless the hand that holds it has courage.”",
"“Shadow and light are two sides of the same coin.”",
"“Hero of Twilight, lend your power to this sacred blade.”",
"“The twilight there holds a serene beauty… you have seen it for yourself.”",
"“I... I wanted to see you again, Link.”",
"“Courage need not be remembered, for it is never forgotten.”",
"“Light and shadow can't mix as one, but they can coexist.”"
];

document.getElementById("quote").innerText =
    quotes[Math.floor(Math.random() * quotes.length)];

/* Elementos principais */
const bgMusic = document.getElementById("bgMusic");
const pressSound = document.getElementById("pressSound");
const overlay = document.getElementById("overlay");
const fadeLayer = document.getElementById("fadeLayer");
const bgVideo = document.getElementById("bgVideo");
const secretVideo = document.getElementById("secretVideo");

/* Estado do modo Lullaby */
window.lullabyMode = false;

/* Troca de vídeo conforme orientação do dispositivo */
function updateVideoByOrientation() {
    const isLandscape = window.matchMedia("(orientation: landscape)").matches;

        /* Seleciona vídeo normal ou versão Lullaby */
    const newSrc = isLandscape
        ? (window.lullabyMode ? "ocarina/zelda-lullaby-horizontal.mp4" : "video-horizontal.mp4")
        : (window.lullabyMode ? "ocarina/zelda-lullaby-vertical.mp4"   : "video-vertical.mp4");

    /* Se já está no vídeo certo, não troca */
    if (bgVideo.src.includes(newSrc)) return;

    /* Guarda tempo e estado do vídeo atual */
    const t = bgVideo.currentTime;
    const paused = bgVideo.paused;

    /* Fade-out antes de trocar */
    bgVideo.style.opacity = "0";

    setTimeout(() => {
        bgVideo.src = newSrc;

        /* Restaura posição e play após carregar */
        bgVideo.onloadedmetadata = () => {
            try { bgVideo.currentTime = Math.min(t, bgVideo.duration || 0); } catch(e){}
            if (!paused) bgVideo.play();

            /* Fade-in */
            setTimeout(() => bgVideo.style.opacity = "1", 120);
        };
    }, 250);
}

/* Atualiza vídeo inicialmente e também em mudanças de orientação */
updateVideoByOrientation();
window.addEventListener("orientationchange", updateVideoByOrientation);
window.addEventListener("resize", updateVideoByOrientation);

/* Lista de músicas de fundo */
const musicList = [];
for (let i = 1; i <= 10; i++) musicList.push(`music/music${i}.mp3`);

let lastTrack = -1;

/* Escolhe música aleatória diferente da anterior */
function getRandomTrack() {
    let i;
    do i = Math.floor(Math.random() * musicList.length);
    while (i === lastTrack);
    lastTrack = i;
    return musicList[i];
}

/* Toca música aleatória */
function playRandomMusic() {
    bgMusic.src = getRandomTrack();
    bgMusic.play();
}

bgMusic.onended = playRandomMusic;

/* Filtro visual por horário */
function applyTimeFilter() {
    const hour = new Date().getHours();
    bgVideo.classList.remove('morningFilter','afternoonFilter','nightFilter');

    if (hour >= 6 && hour < 12) bgVideo.classList.add('morningFilter');
    else if (hour >= 12 && hour <18) bgVideo.classList.add('afternoonFilter');
    else bgVideo.classList.add('nightFilter');
}
applyTimeFilter();

/* Flags para exibição da Ocarina */
let ocarinaShouldAppear = false;

/* Clique no botão Start */
document.getElementById("startButton").onclick = () => {

    /* Som do botão */
    pressSound.play();

    /* Fade da tela inicial */
    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
    overlay.style.transition = "opacity 1.5s ease";

    /* Música de fundo com fade-in */
    bgMusic.volume = 0;
    playRandomMusic();

    let v = 0;
    const f = setInterval(() => {
        if (v < 1) { v += 0.02; bgMusic.volume = v; }
        else clearInterval(f);
    }, 80);

    /* Exibe Ocarina quando elegível */
    if (ocarinaShouldAppear) {
        const oc = document.getElementById("ocarina");
        oc.style.display = "flex";
        setTimeout(() => oc.style.opacity = "1", 60);
    }
};

/* ------------------------------------------
   Easter Egg de 10 cliques na hitbox
------------------------------------------ */

let clickCount = 0;
let lastClickTime = 0;

document.getElementById("linkHitbox").addEventListener("click", () => {
    const now = Date.now();

    /* Clicou rápido? soma. Clicou lento? reinicia. */
    if (now - lastClickTime < 400) clickCount++;
    else clickCount = 1;

    lastClickTime = now;

    /* Ativa easter egg */
    if (clickCount >= 10) {
        triggerSecretCutscene();
        clickCount = 0;
    }
});

/* Ativação do easter egg de 10 cliques */
function triggerSecretCutscene() {

    /* Fade inicial */
    fadeLayer.style.opacity = "1";

    setTimeout(() => {

        /* Pausa tudo */
        bgMusic.pause();
        bgVideo.pause();

        /* Mostra vídeo secreto */
        secretVideo.style.display = "block";
        secretVideo.currentTime = 0;
        secretVideo.play();

        /* Quando vídeo terminar */
        secretVideo.onended = () => {

            /* Segundo fade antes de voltar ao normal */
            fadeLayer.style.opacity = "1";

            setTimeout(() => {

                /* Some vídeo secreto */
                secretVideo.style.display = "none";

                /* Retoma vídeo e música */
                bgVideo.play();
                playRandomMusic();

                /* Fade-out final */
                fadeLayer.style.opacity = "0";

            }, 800);
        };

        fadeLayer.style.opacity = "0";

    }, 800);
}

/* ------------------------------------------
      OCARINA: lógica de visitas
------------------------------------------ */

let visits = Number(localStorage.getItem("visits") || 0) + 1;
localStorage.setItem("visits", visits);

/* Mostra a ocarina na 4ª visita, ou com 30% nas demais */
if (visits === 4) ocarinaShouldAppear = true;
else if (visits > 4 && Math.random() < 0.30) ocarinaShouldAppear = true;

/* Sequência tocada pelo usuário */
const seq = [];
const correctSeq = ["L","U","R","L","U","R"];

/* Sons das notas */
const sounds = {
    L: new Audio("ocarina/left-oc.mp3"),
    U: new Audio("ocarina/up-oc.mp3"),
    R: new Audio("ocarina/right-oc.mp3"),
};

/* ------------------------------------------
      Tocar uma nota da Ocarina
------------------------------------------ */
function playNote(note) {

    /* Armazena nota */
    seq.push(note);

    /* Reinicia som para tocar imediatamente */
    sounds[note].currentTime = 0;
    sounds[note].play();

    /* Mantém apenas o tamanho da sequência-correta */
    if (seq.length > correctSeq.length) seq.shift();

    /* Verifica se a música certa foi tocada */
    if (seq.join("") === correctSeq.join("")) {
        seq.length = 0;
        triggerLullabySequence();
    }
}

/* Eventos de clique nos botões */
document.getElementById("btnLeft").addEventListener("click", () => playNote("L"));
document.getElementById("btnUp").addEventListener("click", () => playNote("U"));
document.getElementById("btnRight").addEventListener("click", () => playNote("R"));

/* ------------------------------------------
      Ativação do Easter Egg da Lullaby
------------------------------------------ */

function triggerLullabySequence() {

    /* Som de acerto imediato */
    const correctSound = new Audio("ocarina/song-correct.mp3");
    correctSound.currentTime = 0;
    correctSound.play();

    /* Some a Ocarina com fade */
    const oc = document.getElementById("ocarina");
    oc.style.transition = "opacity 0.6s ease";
    oc.style.opacity = "0";

    setTimeout(() => {

        /* Escurece a tela */
        fadeLayer.style.transition = "opacity 0.6s ease";
        fadeLayer.style.opacity = "1";

        /* Pausa áudio e vídeo atuais */
        try { bgMusic.pause(); } catch(e){}
        try { bgVideo.pause(); } catch(e){}

        /* Toca a música curta antes da transição */
        const oot = new Audio("ocarina/oot-lullaby.mp3");
        oot.currentTime = 0;
        oot.play();

        oot.onended = () => {

            /* Esconde a ocarina permanentemente */
            oc.style.display = "none";

            /* Ativa modo Lullaby (troca de vídeo) */
            window.lullabyMode = true;

            /* Fade-out antes da troca */
            bgVideo.style.opacity = "0";

            /* Atualiza vídeo conforme orientação */
            updateVideoByOrientation();

            /* Quando novo vídeo carregar */
            bgVideo.onloadedmetadata = () => {

                /* Reinicia do começo */
                try { bgVideo.currentTime = 0; } catch(e){}
                try { bgVideo.play(); } catch(e){}

                /* Fade-in suave do novo vídeo */
                setTimeout(() => {
                    bgVideo.style.opacity = "1";
                }, 180);
            };

            /* Começa música bg no music3.mp3 */
            bgMusic.src = "music/music3.mp3";
            bgMusic.currentTime = 0;
            bgMusic.play();

            /* Quando music3 acabar → playlist aleatória volta ao normal */
            bgMusic.onended = () => {
                bgMusic.onended = playRandomMusic;
                playRandomMusic();
            };

            /* Fade-out final do escuro */
            setTimeout(() => {
                fadeLayer.style.opacity = "0";
            }, 350);
        };

    }, 650);
}
</script>

</body>
</html>
