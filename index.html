<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Twilight Memory</title>

<style>
    @font-face {
        font-family: "WiiRegular";
        src: url("TPHylian-WiiRegular.otf");
    }
    @font-face {
        font-family: "GCNBold";
        src: url("TPHylian-GCNBold.otf");
    }

    body {
        margin: 0;
        overflow: hidden;
        background: black;
        font-family: "WiiRegular", serif;
    }

    #bgVideo {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: 1;
        transition: filter 1s ease;
    }

    .morningFilter {
        filter: brightness(1.15) saturate(1.1) sepia(0.08) hue-rotate(-5deg) contrast(1.03);
    }
    .afternoonFilter {
        filter: brightness(1.05) saturate(1.15) hue-rotate(8deg) contrast(1.05) saturate(1.08);
    }
    .nightFilter {
       filter: brightness(0.65) saturate(0.85) hue-rotate(-25deg) contrast(0.92) brightness(0.85);
    }

    #secretVideo {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: fill;
        z-index: 9999;
        display: none;
        background: black;
    }
    
    #overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        z-index: 2;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        backdrop-filter: blur(2px);
    }

    #quote {
        font-family: "WiiRegular";
        color: #e8d8a8;
        font-size: 1.3rem;
        max-width: 90vw;
        text-align: center;
        margin-bottom: 40px;
        text-shadow: 2px 2px 4px black;
    }

    #startButton {
        font-family: "GCNBold";
        font-size: 2rem;
        color: #e8d8a8;
        border: 2px solid #e8d8a8;
        padding: 12px 28px;
        border-radius: 4px;
        cursor: pointer;
        background: rgba(0,0,0,0.6);
        text-shadow: 2px 2px 4px black;
        transition: 0.25s;
    }

    #startButton:hover {
        background: rgba(255,255,255,0.1);
        transform: scale(1.05);
    }

    #fadeLayer {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: black;
        z-index: 8;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1s ease;
    }

    #linkHitbox {
        position: fixed;
        width: 10vw;
        height: 10vw;
        max-width: 150px;
        max-height: 150px;
        left: 18vw;
        top: 40vh;
        z-index: 5;
        background: rgba(255, 0, 0, 0);
    }
</style>
</head>

<body>

<video id="bgVideo" src="video.mp4" autoplay loop muted playsinline></video>

<video id="secretVideo" src="easter-eggs/creepy-link-scene.mp4" playsinline></video>

<!-- NOVO: o arquivo src original não é mais usado -->
<audio id="bgMusic"></audio>
<audio id="pressSound" src="press-start.mp3"></audio>

<div id="overlay">
    <div id="quote"></div>
    <div id="startButton">PRESS START</div>
</div>

<div id="fadeLayer"></div>

<div id="linkHitbox"></div>

<script>
/* Quotes */
const quotes = [
    "“A sword wields no strength unless the hand that holds it has courage.”",
    "“Shadow and light are two sides of the same coin.”",
    "“Hero of Twilight, lend your power to this sacred blade.”",
    "“The twilight there holds a serene beauty… you have seen it for yourself.”",
    "“I... I wanted to see you again, Link.”",
    "“Courage need not be remembered, for it is never forgotten.”",
    "“Light and shadow can't mix as one, but they can coexist.”"
];

document.getElementById("quote").innerText =
    quotes[Math.floor(Math.random() * quotes.length)];

const bgMusic = document.getElementById("bgMusic");
const pressSound = document.getElementById("pressSound");
const overlay = document.getElementById("overlay");
const fadeLayer = document.getElementById("fadeLayer");

const bgVideo = document.getElementById("bgVideo");
const secretVideo = document.getElementById("secretVideo");

/* --- NEW MUSIC SYSTEM --- */
const musicList = [];

// load music1.mp3 to music10.mp3
for (let i = 1; i <= 10; i++) {
    musicList.push(`music/music${i}.mp3`);
}

let lastTrack = -1;

// pick a different random index
function getRandomTrack() {
    let index;
    do {
        index = Math.floor(Math.random() * musicList.length);
    } while (index === lastTrack);
    lastTrack = index;
    return musicList[index];
}

function playRandomMusic() {
    bgMusic.src = getRandomTrack();
    bgMusic.play();
}

// when song ends, play another
bgMusic.onended = playRandomMusic;

/* ---------- TIME FILTER ---------- */
function applyTimeFilter() {
    const hour = new Date().getHours();
    bgVideo.classList.remove('morningFilter', 'afternoonFilter', 'nightFilter');

    if (hour >= 6 && hour < 12) {
        bgVideo.classList.add('morningFilter');
    } else if (hour >= 12 && hour < 18) {
        bgVideo.classList.add('afternoonFilter');
    } else {
        bgVideo.classList.add('nightFilter');
    }
}
applyTimeFilter();

/* ---------- START BUTTON ---------- */
document.getElementById("startButton").onclick = () => {
    pressSound.play();

    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
    overlay.style.transition = "opacity 1.5s ease";

    bgMusic.volume = 0;
    playRandomMusic(); // NEW

    let vol = 0;
    const fadeInterval = setInterval(() => {
        if (vol < 1) {
            vol += 0.02;
            bgMusic.volume = vol;
        } else {
            clearInterval(fadeInterval);
        }
    }, 80);
};

/* ---------- SECRET CUTSCENE ---------- */
let clickCount = 0;
let lastClickTime = 0;

document.getElementById("linkHitbox").addEventListener("click", () => {
    const now = Date.now();

    if (now - lastClickTime < 400) {
        clickCount++;
    } else {
        clickCount = 1;
    }

    lastClickTime = now;

    if (clickCount >= 10) {
        triggerSecretCutscene();
        clickCount = 0;
    }
});

function triggerSecretCutscene() {
    fadeLayer.style.opacity = "1";

    setTimeout(() => {
        bgMusic.pause();
        bgVideo.pause();

        secretVideo.style.display = "block";
        secretVideo.currentTime = 0;
        secretVideo.play();

        secretVideo.onended = () => {
            fadeLayer.style.opacity = "1";

            setTimeout(() => {
                secretVideo.style.display = "none";
                bgVideo.play();
                playRandomMusic();
                fadeLayer.style.opacity = "0";
            }, 800);
        };

        fadeLayer.style.opacity = "0";
    }, 800);
}
</script>

</body>
</html>
