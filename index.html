<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Twilight Memory</title>

<style>
    /* Fontes */
    @font-face {
        font-family: "WiiRegular";
        src: url("TPHylian-WiiRegular.otf");
    }
    @font-face {
        font-family: "GCNBold";
        src: url("TPHylian-GCNBold.otf");
    }

    /* Corpo */
    body {
        margin: 0;
        overflow: hidden;
        background: black;
        font-family: "WiiRegular", serif;
    }

    /* Vídeo de fundo */
    #bgVideo {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: 1;
        transition: filter 1s ease, opacity 1s ease;
        opacity: 1;
    }

    /* Filtros */
    .morningFilter {
        filter: brightness(1.15) saturate(1.1) sepia(0.08) hue-rotate(-5deg) contrast(1.03);
    }
    .afternoonFilter {
        filter: brightness(1.05) saturate(1.15) hue-rotate(8deg) contrast(1.05);
    }
    .nightFilter {
        filter: brightness(0.65) saturate(0.85) hue-rotate(-25deg) brightness(0.85);
    }

    /* Vídeo secreto */
    #secretVideo {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: fill;
        z-index: 9999;
        display: none;
        background: black;
    }

    /* Tela de Start */
    #overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        z-index: 2;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        backdrop-filter: blur(2px);
    }

    #quote {
        font-family: "WiiRegular";
        color: #e8d8a8;
        font-size: 1.3rem;
        max-width: 90vw;
        text-align: center;
        margin-bottom: 40px;
        text-shadow: 2px 2px 4px black;
    }

    #startButton {
        font-family: "GCNBold";
        font-size: 2rem;
        color: #e8d8a8;
        border: 2px solid #e8d8a8;
        padding: 12px 28px;
        border-radius: 4px;
        cursor: pointer;
        background: rgba(0,0,0,0.6);
        text-shadow: 2px 2px 4px black;
        transition: 0.25s;
    }
    #startButton:hover {
        background: rgba(255,255,255,0.1);
        transform: scale(1.05);
    }

    /* Fade geral */
    #fadeLayer {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        background: black;
        z-index: 8;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1s ease;
    }

    /* Hitbox do easter egg */
    #linkHitbox {
        position: fixed;
        width: 10vw;
        height: 10vw;
        max-width: 150px;
        max-height: 150px;
        left: 18vw;
        top: 40vh;
        z-index: 5;
        background: rgba(255, 0, 0, 0);
    }

    /* Container das teclas da Ocarina */
    .ocarina-container {
        position: fixed;
        right: 20px;
        bottom: 20px;
        display: flex;
        gap: 12px;
        z-index: 10;
        opacity: 0;
        transition: opacity 1.4s ease;
        align-items: flex-end;
    }

    /* Ícone da Ocarina (novo) */
    #ocarinaIcon {
        position: fixed;
        right: 20px;
        bottom: 20px;
        width: 90px;
        opacity: 0;
        z-index: 10;
        display: none;
        animation: wiggle 2.5s infinite ease-in-out;
        transition: opacity 1s ease;
    }

    /* Wiggle leve */
    @keyframes wiggle {
        0%   { transform: translateY(0px) rotate(0deg); }
        50%  { transform: translateY(-4px) rotate(-2deg); }
        100% { transform: translateY(0px) rotate(0deg); }
    }

    /* Botões */
    .ocarina-btn {
        width: 65px;
        height: 65px;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent !important;
        transition: transform 0.12s ease;
        opacity: 0.82;
    }

    .ocarina-btn:active {
        transform: scale(0.86);
    }

    /* Wrapper para elevar o botão Up sem afetar o transform do botão */
    .ocarina-up-wrapper {
        transform: translateY(-22px);
        display: flex;
        align-items: center;
        justify-content: center;
    }

</style>
</head>

<body>

<!-- Vídeo principal -->
<video id="bgVideo" src="video-vertical.mp4" autoplay loop muted playsinline></video>

<!-- Vídeo secreto -->
<video id="secretVideo" src="easter-eggs/creepy-link-scene.mp4" playsinline></video>

<!-- Música -->
<audio id="bgMusic"></audio>

<!-- Som Start -->
<audio id="pressSound" src="sounds/press-start-TP.wav"></audio>

<!-- Ícone da Ocarina (novo) -->
<img id="ocarinaIcon" src="ocarina/ocarina-icon.png">

<!-- Teclas da Ocarina -->
<div id="ocarina" class="ocarina-container" style="display:none;">
    <img id="btnLeft"  class="ocarina-btn" src="ocarina/left-ar-oc.png">
    <div class="ocarina-up-wrapper">
        <img id="btnUp"    class="ocarina-btn" src="ocarina/up-ar-oc.png">
    </div>
    <img id="btnRight" class="ocarina-btn" src="ocarina/right-ar-oc.png">
</div>

<!-- Tela inicial -->
<div id="overlay">
    <div id="quote"></div>
    <div id="startButton">PRESS START</div>
</div>

<!-- Fade -->
<div id="fadeLayer"></div>

<!-- Hitbox -->
<div id="linkHitbox"></div>

<script>
/* Frases */
const quotes = [
"“A sword wields no strength unless the hand that holds it has courage.”",
"“Shadow and light are two sides of the same coin.”",
"“Hero of Twilight, lend your power to this sacred blade.”",
"“The twilight there holds a serene beauty… you have seen it for yourself.”",
"“I... I wanted to see you again, Link.”",
"“Courage need not be remembered, for it is never forgotten.”",
"“Light and shadow can't mix as one, but they can coexist.”"
];

document.getElementById("quote").innerText =
  quotes[Math.floor(Math.random() * quotes.length)];

/* Elementos */
const bgMusic = document.getElementById("bgMusic");
const pressSound = document.getElementById("pressSound");
const overlay = document.getElementById("overlay");
const fadeLayer = document.getElementById("fadeLayer");
const bgVideo = document.getElementById("bgVideo");
const secretVideo = document.getElementById("secretVideo");
const ocarinaIcon = document.getElementById("ocarinaIcon");

window.lullabyMode = false;

/* Troca vídeo por orientação */
function updateVideoByOrientation() {
    const isLandscape = window.matchMedia("(orientation: landscape)").matches;

    const newSrc = isLandscape
        ? (window.lullabyMode ? "ocarina/zelda-lullaby-horizontal.mp4" : "video-horizontal.mp4")
        : (window.lullabyMode ? "ocarina/zelda-lullaby-vertical.mp4"   : "video-vertical.mp4");

    if (bgVideo.src.includes(newSrc)) return;

    const t = bgVideo.currentTime;
    const paused = bgVideo.paused;

    bgVideo.style.opacity = "0";

    setTimeout(() => {
        bgVideo.src = newSrc;
        bgVideo.onloadedmetadata = () => {
            try { bgVideo.currentTime = Math.min(t, bgVideo.duration || 0); } catch(e){}
            if (!paused) bgVideo.play();
            setTimeout(() => bgVideo.style.opacity = "1", 120);
        };
    }, 250);
}

updateVideoByOrientation();
window.addEventListener("orientationchange", updateVideoByOrientation);
window.addEventListener("resize", updateVideoByOrientation);

/* Lista das músicas */
const musicList = [];
for (let i = 1; i <= 10; i++) musicList.push(`music/music${i}.mp3`);

let lastTrack = -1;

/* Música aleatória */
function getRandomTrack() {
    let i;
    do i = Math.floor(Math.random() * musicList.length);
    while (i === lastTrack);
    lastTrack = i;
    return musicList[i];
}

function playRandomMusic() {
    bgMusic.src = getRandomTrack();
    bgMusic.play();
}
bgMusic.onended = playRandomMusic;

/* Filtro por horário */
function applyTimeFilter() {
    const h = new Date().getHours();
    bgVideo.classList.remove("morningFilter","afternoonFilter","nightFilter");

    if (h >= 6 && h < 12) bgVideo.classList.add("morningFilter");
    else if (h >= 12 && h < 18) bgVideo.classList.add("afternoonFilter");
    else bgVideo.classList.add("nightFilter");
}
applyTimeFilter();

/* Lógica de visitas */
let visits = Number(localStorage.getItem("visits") || 0) + 1;
localStorage.setItem("visits", visits);

/* Regras para aparecer a Ocarina */
let ocarinaShouldAppear = false;
if (visits === 4) ocarinaShouldAppear = true;
else if (visits > 4 && Math.random() < 0.30) ocarinaShouldAppear = true;

/* Clique no botão Start */
document.getElementById("startButton").onclick = () => {

    pressSound.play();

    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
    overlay.style.transition = "opacity 1.5s ease";

    bgMusic.volume = 0;
    playRandomMusic();
    let v = 0;
    const fadeM = setInterval(() => {
        if (v < 1) { v += 0.02; bgMusic.volume = v; }
        else clearInterval(fadeM);
    }, 80);

    /* Só mostra o ícone da ocarina agora */
    if (ocarinaShouldAppear) {
        showOcarinaIcon();
    }
};

/* ----------------------------------------------------------
   SEQUÊNCIA NOVA: Ocarina Found → ícone → clique → teclas
---------------------------------------------------------- */

/* EFEITOS */
const ocarinaFoundSfx = new Audio("ocarina/fairy-ocarina-get.wav");
const ocarinaSelectSfx = new Audio("ocarina/select-ocarina.wav");

function showOcarinaIcon() {

    /* Toca som de descoberta */
    ocarinaFoundSfx.currentTime = 0;
    ocarinaFoundSfx.play();

    /* Espera 1s antes de aparecer */
    setTimeout(() => {
        ocarinaIcon.style.display = "block";
        setTimeout(() => {
            ocarinaIcon.style.opacity = "1";
        }, 30);
    }, 1000);
}

/* Ao clicar no ícone */
ocarinaIcon.addEventListener("click", () => {

    /* Som de clique */
    ocarinaSelectSfx.currentTime = 0;
    ocarinaSelectSfx.play();

    /* Some rápido */
    ocarinaIcon.style.transition = "opacity 0.25s ease";
    ocarinaIcon.style.opacity = "0";

    setTimeout(() => {
        ocarinaIcon.style.display = "none";
        showOcarinaButtons();
    }, 260);
});

/* Mostrar as teclas */
function showOcarinaButtons() {
    const oc = document.getElementById("ocarina");
    oc.style.display = "flex";
    setTimeout(() => oc.style.opacity = "1", 60);
}

/* ----------------------------------------------------------
   Easter Egg oculto: 10 cliques rápidos na hitbox
---------------------------------------------------------- */

let clickCount = 0;
let lastClickTime = 0;

document.getElementById("linkHitbox").addEventListener("click", () => {
    const now = Date.now();

    /* Clicou rápido? soma. Clicou lento? reinicia. */
    if (now - lastClickTime < 400) clickCount++;
    else clickCount = 1;

    lastClickTime = now;

    /* Ativa easter egg */
    if (clickCount >= 10) {
        triggerSecretCutscene();
        clickCount = 0;
    }
});

/* Vídeo secreto */
function triggerSecretCutscene() {

    fadeLayer.style.opacity = "1";

    setTimeout(() => {

        bgMusic.pause();
        bgVideo.pause();

        secretVideo.style.display = "block";
        secretVideo.currentTime = 0;
        secretVideo.play();

        secretVideo.onended = () => {

            fadeLayer.style.opacity = "1";

            setTimeout(() => {

                secretVideo.style.display = "none";
                bgVideo.play();
                playRandomMusic();

                fadeLayer.style.opacity = "0";

            }, 800);
        };

        fadeLayer.style.opacity = "0";

    }, 800);
}

/* ----------------------------------------------------------
   Lógica da execução musical da Ocarina
---------------------------------------------------------- */

const seq = [];
const correctSeq = ["L","U","R","L","U","R"];

const sounds = {
    L: new Audio("ocarina/left-oc.mp3"),
    U: new Audio("ocarina/up-oc.mp3"),
    R: new Audio("ocarina/right-oc.mp3"),
};

/* Tocar nota */
function playNote(n) {

    /* Toca som imediatamente */
    sounds[n].currentTime = 0;
    sounds[n].play();

    /* Guarda sequência */
    seq.push(n);
    if (seq.length > correctSeq.length) seq.shift();

    /* Verifica se acertou */
    if (seq.join("") === correctSeq.join("")) {
        seq.length = 0;
        triggerLullabySequence();
    }
}

/* Eventos */
document.getElementById("btnLeft").addEventListener("click", () => playNote("L"));
document.getElementById("btnUp").addEventListener("click", () => playNote("U"));
document.getElementById("btnRight").addEventListener("click", () => playNote("R"));

/* ----------------------------------------------------------
     Ativação do evento Lullaby
---------------------------------------------------------- */

function triggerLullabySequence() {

    /* Som de acerto */
    const correctSound = new Audio("ocarina/song-correct.mp3");
    correctSound.currentTime = 0;
    correctSound.play();

    /* Some as teclas */
    const oc = document.getElementById("ocarina");
    oc.style.transition = "opacity 0.6s ease";
    oc.style.opacity = "0";

    setTimeout(() => {

        /* Escurece tela */
        fadeLayer.style.transition = "opacity 0.6s ease";
        fadeLayer.style.opacity = "1";

        try { bgMusic.pause(); } catch(e){}
        try { bgVideo.pause(); } catch(e){}

        /* Toca música curta antes da troca */
        const oot = new Audio("ocarina/oot-lullaby.mp3");
        oot.currentTime = 0;
        oot.play();

        oot.onended = () => {

            oc.style.display = "none";

            /* Ativa modo Lullaby */
            window.lullabyMode = true;

            /* Fade */
            bgVideo.style.opacity = "0";

            /* Troca vídeo conforme orientação */
            updateVideoByOrientation();

            bgVideo.onloadedmetadata = () => {

                try { bgVideo.currentTime = 0; } catch(e){}
                try { bgVideo.play(); } catch(e){}

                setTimeout(() => {
                    bgVideo.style.opacity = "1";
                }, 180);
            };

            /* Toca music3 primeiro */
            bgMusic.src = "music/music3.mp3";
            bgMusic.currentTime = 0;
            bgMusic.play();

            bgMusic.onended = () => {
                bgMusic.onended = playRandomMusic;
                playRandomMusic();
            };

            /* Desfade */
            setTimeout(() => {
                fadeLayer.style.opacity = "0";
            }, 350);
        };

    }, 650);
}
</script>

</body>
</html>
